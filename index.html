<!doctype html>
<html lang="zh">

<head>
    <meta charset="utf-8">
    <title>唯哆apk下载</title>
    <link rel="stylesheet" type="text/css" href="css/home.css"/>
    
</head>

<body>
    <div class="all_center">
        <h1>唯哆内测apk下载</h1>
        
        <div class="top_row">
            <img class="logo_img" src="assets/logo.png" alt="App Logo"/>
            <div class="top_column">
                <h4>应用名：唯哆</h4>
				<div style="display: inline-block; text-align: left;">
					<h5>版本信息: V2.4.0_20231023 17:34:59</h5>
					<h5 id="iosInfo">iOS版本信息: V2.4.0_20231023 17:35:31</h5>
					<h5 id="vfplayerDemo">播放器demo更新信息: 20230918 17_25_27</h5>
				</div>  
            </div>
        </div>
        <div class="top_row" id="buttons" style="display: none;">
            <a href="https://test.sihuacloud.com:39002/app/V2.4.0/apk/20231023/17_34_59.apk" id="download"></a>
            <button class="button_download" id="releaseButton" onclick="downloadReleaseApk()">release apk下载</button>
            <button class="button_download" id="debugButton" onclick="downloadDebugApk()">debug apk下载</button>
            <button class="button_download" id="ipaButton" onclick="downloadIpa()">iOS下载</button>
            <button class="button_download" id="vfplayerDemoButton" onclick="downloadVfplayerDemo()">播放器demo下载</button>
        </div>
        <br>
        <div class="bottom_column" id="qrcode" style="display: none;">
                <p>扫描下方二维码直接下载release版的apk文件</p>
                <img class="qrcode_img" src="assets/downloadqrcode.png" id="qrImg" alt="QR Code" class="img-fluid" />
        </div>
        
    </div>
    <div class="dialog_center" id="inputDialog" style="display: block;">
        <h2>口令</h2>
        <input type="text" id="codeInput" placeholder="请输入口令">
        <button id="validateBtn">提交</button>
    </div>

    <script>

      var button = document.getElementById('download');
      var originalString = button.href;
      originalString = originalString.replace('.apk', '');
      var words = originalString.split("/");
      console.log(words);
      if (words.length >= 2) {
        let first = words[words.length - 2];
        let second = words[words.length - 1];
        
        var qrImg = document.getElementById('qrImg');
        qrImg.src = "assets/downloadqrcode" + first + second + ".png";

      }

        function downloadDebugApk() {
            var button = document.getElementById('download');
            let originalString = button.href;
            let replacedString = originalString.replace('.apk', '_debug.apk');
            let downloadLink = document.createElement('a');
            downloadLink.href = replacedString;
            downloadLink.style.display = 'none';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);

        }
        function downloadReleaseApk() {
            var button = document.getElementById('download');
            let originalString = button.href;
            let downloadLink = document.createElement('a');
            downloadLink.href = originalString;
            downloadLink.style.display = 'none';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }
        function downloadIpa(){
          var platform = navigator.platform.toLowerCase();
          if (platform.includes("iphone") || platform.includes("ipad") || platform.includes("ipod")) {

            var isWeChat = /micromessenger/i.test(navigator.userAgent);
            var isDingTalk = /dingtalk/i.test(navigator.userAgent);
            if (isWeChat || isDingTalk) {
              openSafari();
            }else{
              downloadiOS();
            }
          }else{
            alert("请使用iOS设备下载哦！");
          }

        }
        function openSafari() {
          if (/iphone|ipod|ipad/i.test(navigator.userAgent)) {
            window.location.href = 'itms-services:///?action=download-manifest&url=https://test.sihuacloud.com:39002/app/wiodo_ipa/manifest.plist';
          } else {
            console.log('This feature is only available on iOS devices.');
          }
        }
        function downloadiOS(){
          let downloadLink = document.createElement('a');
            downloadLink.href = "itms-services:///?action=download-manifest&url=https://test.sihuacloud.com:39002/app/wiodo_ipa/manifest.plist";
            downloadLink.style.display = 'none';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }
        function downloadVfplayerDemo(){

          var vfplayerDemo = document.getElementById('vfplayerDemo');
          var text = vfplayerDemo.innerHTML;
          var words = text.split(" ");
          console.log(words);
          var url = "https://test.sihuacloud.com:39002/app/vfplayer_demo/" + words[words.length-2] + "/" + words[words.length-1] + ".apk";
          let downloadLink = document.createElement('a');
            downloadLink.href = url;
            downloadLink.style.display = 'none';
            document.body.appendChild(downloadLink);
            downloadLink.click();
            document.body.removeChild(downloadLink);
        }
        if (!getValue()) {
            var validateBtn = document.getElementById("validateBtn");
            var codeInput = document.getElementById("codeInput");
            validateBtn.addEventListener("click", function() {
                var code = codeInput.value;
                if (code == "wiodo1234") {
                  alert("验证通过！");
                  var buttons = document.getElementById("buttons");
                  buttons.style.display = "block";
                  var qrcode = document.getElementById("qrcode");
                  qrcode.style.display = "block";
                  var inputDialog = document.getElementById("inputDialog");
                  inputDialog.style.display = "none";
                  setValue();
                } else {
                  alert("验证码错误！");
                }
              });
            codeInput.addEventListener("keyup", function(event) {
                if (event.keyCode == 13) {
                    var code = codeInput.value;
                    if (code == "wiodo1234") {
                      alert("验证通过！");
                      var buttons = document.getElementById("buttons");
                      buttons.style.display = "block";
                      var qrcode = document.getElementById("qrcode");
                      qrcode.style.display = "block";
                      var inputDialog = document.getElementById("inputDialog");
                      inputDialog.style.display = "none";
                      setValue();
                    } else {
                      alert("验证码错误！");
                    }
                    
                }
                
              });
        }else{
            var buttons = document.getElementById("buttons");
            buttons.style.display = "block";
            var qrcode = document.getElementById("qrcode");
            qrcode.style.display = "block";
            var inputDialog = document.getElementById("inputDialog");
            inputDialog.style.display = "none";
        }

        function setValue() {
          var expirationTime = new Date().getTime() + (2 * 60 * 1000);
          var data = {
            expiresAt: expirationTime
          };
          localStorage.setItem("validate", JSON.stringify(data));
        }

        function getValue() {
          var data = localStorage.getItem("validate");
          if (data) {
            data = JSON.parse(data);
            if (new Date().getTime() < data.expiresAt) {
              return true;
            } else {
              localStorage.removeItem("validate");
              return false;
            }
          }
          return false;
        }


    </script>
</body>

</html>
